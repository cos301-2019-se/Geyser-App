<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="utf-8">

<style> 
input[type=text] 
{
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  box-sizing: border-box;
}
</style>

</head>

<body>
<script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-app.js"></script>
 <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-storage.js"></script>

	
	
	<button onclick= search()>View cases that needs to be closed </button>
	
	<p id = "testing"></p>
	
	<label>Case Closed by (Agent ID)</label>
	<input type="text" name="textbox19" list="exampleList" id = "test" required >
		<datalist id="exampleList">
			<option value="ARvCV6mlk">  
			<option value="AXJXoxUcT">
			<option value="AmYRVePKB">
			<option value="AqFqK4rxM">
			<option value="Av5cwg13a">
			
	    </datalist>
	<button onclick= add()>Close the case </button>

   
  


<script>

var firebaseConfig = {
    apiKey: "AIzaSyDibg-oYRpVXU9HqCAOLdxIpYXcZUPpAGM",
    authDomain: "geyser-74ddf.firebaseapp.com",
    databaseURL: "https://geyser-74ddf.firebaseio.com",
    projectId: "geyser-74ddf",
    storageBucket: "geyser-74ddf.appspot.com",
    messagingSenderId: "1001903322970",
    appId: "1:1001903322970:web:a904b91e99d67b22"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  var db = firebase.firestore();
  
/*
function searchName() {
//var agentID1 = document.getElementById('textbox1').value;  // get agent ID
var closed1 = genDate();
 const display=document.querySelector("#test");
db.collection("caseDetails").get().then(function(querySnapshot)
{
  querySnapshot.forEach(function(doc)
  {
            var html = " ";
			var com = "completed";
			var check = doc.data().caseStatus;
			
			
			console.log(check);
			if(com==doc.data().caseStatus)
			{
			
			
			display.innerHTML +=doc.data().caseStatus + "<br>";
			//display.innerHTML += "<table width='200' border='1' ><tr><td>"+doc.data().caseStatus +"</td><td> " + doc.data().caseID+"</td><td> "+doc.data().caseOpenedBy+"</td></tr></table><br/>";
            var to = doc.data().caseID;
			
			// this code below is used to update the field
			db.collection("caseDetails").doc(to).update(
				{
					
					closeByAgentID : "done",
				})
			}		
		
});
	
	
});




}

*/

function genDate()
{
     var today = new Date();
     var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
       
	  return date;
}

function add() 
{
  
	
	const display=document.querySelector("#display");
	var date = genDate();
	var agent = document.getElementById("test").value;
	alert(agent);
	var com = "completed";
	db.collection("caseDetails").get().then(function(querySnapshot)
	{
		querySnapshot.forEach(function(doc)
		{
			if(com==doc.data().caseStatus)
			{
			   
				db.collection("caseDetails").doc(doc.id).update({caseClosedBy: agent, caseClosedDate :date  });
			}
	   });
		
	});

}

function search()
{


	const display=document.querySelector("#testing");
	var date = genDate();
	
	var com = "completed";
	var u = "unknown";
	db.collection("caseDetails").get().then(function(querySnapshot)
	{
		querySnapshot.forEach(function(doc)
		{
			if(com==doc.data().caseStatus && u==doc.data().caseClosedBy)
			{
			  display.innerHTML += "<table width='200' border='1' ><tr><td>"+doc.data().caseStatus +"</td><td> " + doc.data().caseID+"</td><td> "+doc.data().caseClosedDate+"</td></tr></table><br/>";
			}
	   });
		
	});


}











  


</script>

</body>

</html>